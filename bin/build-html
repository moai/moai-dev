#!/bin/bash

#
# Build script for Html5 Host
# Usage: Run from Moai SDK's root directory:
#
# ./bin/build-html
#
# You can change the CMake options using -DOPTION=VALUE
# Check moai-dev/cmake/CMakeLists.txt for all the available options.
#
# The modules that are set in FALSE are not working or tested
#
# Please, check cmake/[module] for more info.
#
# Thanks!

: ${EMSCRIPTEN_HOME?"EMSCRIPTEN_HOME is not defined. Please set to the location of your emscripten install (path)"}

cd cmake
rm -rf build
mkdir build
cd build
cmake \
-DEMSCRIPTEN_HOME=${EMSCRIPTEN_HOME} \
-DCMAKE_C_COMPILER=${EMSCRIPTEN_HOME}/emcc \
-DCMAKE_CXX_COMPILER=$EMSCRIPTEN_HOME/em++ \
-DCMAKE_LINKER=$EMSCRIPTEN_HOME/emcc \
-DCMAKE_CXX_LINKER=$EMSCRIPTEN_HOME/emcc \
-DCMAKE_C_LINK_EXECUTABLE=$EMSCRIPTEN_HOME/emcc \
-DCMAKE_CXX_LINK_EXECUTABLE=$EMSCRIPTEN_HOME/emcc \
-DBUILD_HTML=TRUE \
-DMOAI_BOX2D=TRUE \
-DMOAI_CHIPMUNK=FALSE \
-DMOAI_CURL=FALSE \
-DMOAI_CRYPTO=FALSE \
-DMOAI_EXPAT=FALSE \
-DMOAI_FREETYPE=TRUE \
-DMOAI_JSON=TRUE \
-DMOAI_JPG=FALSE \
-DMOAI_MONGOOSE=FALSE \
-DMOAI_OGG=FALSE \
-DMOAI_OPENSSL=FALSE \
-DMOAI_SQLITE3=FALSE \
-DMOAI_TINYXML=TRUE \
-DMOAI_PNG=TRUE \
-DMOAI_SFMT=FALSE \
-DMOAI_VORBIS=FALSE \
-DMOAI_HTTP_CLIENT=FALSE \
-DMOAI_UNTZ=TRUE \
../
if [[ $? -ne 0 ]]; then
    exit 1
fi

make host-html-template
if [[ $? -ne 0 ]]; then
  exit 1
fi

#
# Copy libs to lib/blackberry
#
#rm -rf ../../lib/blackberry
#mkdir -p ../../lib/blackberry
#for i in * ; do
#  if [ -d "$i" ]; then
#    if [ -f $i/lib$i.a ]; then
#      echo "Copying $i/lib$i.a to lib/blackberry/"
#      cp $i/lib$i.a ../../lib/blackberry
#    fi
#  fi
#done
