cmake_minimum_required ( VERSION 2.8.5 )
project ( moai-android )

set ( MOAI_ANDROID_MODULES "" )

#import our android module macro
include("./android-module.cmake")

add_subdirectory(moai-android-adcolony)
add_subdirectory(moai-android-amazon-billing)
add_subdirectory(moai-android-chartboost)
add_subdirectory(moai-android-crittercism)
add_subdirectory(moai-android-facebook)
add_subdirectory(moai-android-flurry)
add_subdirectory(moai-android-fortumo)
add_subdirectory(moai-android-google-billing)
add_subdirectory(moai-android-google-play-services)
add_subdirectory(moai-android-google-push)
add_subdirectory(moai-android-tapjoy)
add_subdirectory(moai-android-twitter)
add_subdirectory(moai-android-vungle)

set ( MOAI_ANDROID_INCLUDES 
  "${MOAI_ROOT}/src/"
  "${CMAKE_BINARY_DIR}/libmoai/config"
 )

include_directories ( 
  ${MOAI_ANDROID_INCLUDES} 
)

set ( CMAKE_CURRENT_SOURCE_DIR "${MOAI_ROOT}/src/moai-android/" )

# Use all cpp files in directory as source code
file ( GLOB MOAI_ANDROID_SRC "${CMAKE_CURRENT_SOURCE_DIR}/*.cpp" "${CMAKE_CURRENT_SOURCE_DIR}/*.h" )

#exclude moai.cpp, that is a host file
list(REMOVE_ITEM MOAI_ANDROID_SRC "${CMAKE_CURRENT_SOURCE_DIR}/moai.cpp")

add_library ( moai-android STATIC ${MOAI_ANDROID_SRC} )
target_link_libraries( moai-android moai-sim moai-util moai-core )

install(TARGETS moai-android EXPORT libmoai ARCHIVE DESTINATION lib)
install(DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR} DESTINATION include/moai-android
          FILES_MATCHING PATTERN "*.h")


#jni
#moai.cpp is part of the host and contains our jni calls

#java
FILE(GLOB JAVA_FILES "${CMAKE_CURRENT_SOURCE_DIR}/*.java")
install(DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR} 
  DESTINATION ../modules/moai/moai-android/com/ziplinegames/moai
  PATTERN "*.java"
  PATTERN "*.cpp" EXCLUDE
  PATTERN "*.h" EXCLUDE
  PATTERN "MoaiActivity.java" EXCLUDE
  PATTERN "MoaiView.java" EXCLUDE
)

#dump our modules for the host project

set (DEST "${CMAKE_CURRENT_BINARY_DIR}/moaiandroid.mk")

FILE(WRITE ${DEST} "#generated by moai-android/cmakelists.txt\n\n")

foreach(MOD IN LISTS MOAI_ANDROID_MODULES )
   FILE(APPEND ${DEST} "include $(CLEAR_VARS)\n\n")
   FILE(APPEND ${DEST} "LOCAL_MODULE := ${MOD}\n")
   FILE(APPEND ${DEST} "LOCAL_SRC_FILES := $(MOAI_LIBS)/lib${MOD}.a\n")
   FILE(APPEND ${DEST} "include $(PREBUILT_STATIC_LIBRARY)\n\n")
endforeach(MOD)

install(FILES ${DEST} DESTINATION ../modules/jni)